<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Osaka Go! å‰ä¼Šå¡å“‡ä¹‹æ—…</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; transition: background 0.5s ease; }
        .card { 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 20px rgba(0,0,0, 0.05); 
            transition: all 0.3s;
        }
        .card:active { transform: scale(0.98); }
        
        .avatar-btn { transition: transform 0.2s, filter 0.2s; }
        .avatar-btn:hover { transform: scale(1.1) rotate(5deg); }
        .avatar-btn.active { transform: scale(1.2) translateY(-5px); filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); border: 3px solid white; }

        .ticket-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* åœ°åœ–å®¹å™¨ Iframe */
        .map-container { position: relative; padding-bottom: 60%; height: 0; overflow: hidden; border-radius: 1.5rem; margin-bottom: 1rem; border: 4px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .map-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Go Top æŒ‰éˆ•å‹•ç•« */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s, transform 0.3s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; transform: translateY(20px) scale(0.8); }
    </style>
</head>
<body :class="theme.bgGradient">

<div id="app" class="max-w-md mx-auto min-h-screen pb-32 transition-colors duration-500 relative">
    
    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-50 shadow-sm rounded-b-[2rem] border-b-4 transition-colors duration-500"
            :class="theme.borderColor">
        <div class="p-4">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <h1 class="text-3xl font-black tracking-wide flex items-center gap-2" :class="theme.textColor">
                        Osaka Go!
                        <span class="text-2xl animate-bounce">{{ theme.icon }}</span>
                    </h1>
                    <div class="text-xs font-bold text-gray-400 mt-1 pl-1">12/20 - 12/27 âœ¨ {{ theme.slogan }}</div>
                </div>
                <div class="flex flex-col gap-2">
                    <button @click="expandAll(false)" class="text-[10px] bg-gray-100 text-gray-500 px-3 py-1 rounded-full font-bold hover:bg-gray-200">æ”¶åˆ</button>
                    <button @click="expandAll(true)" class="text-[10px] text-white px-3 py-1 rounded-full font-bold shadow-sm" :class="theme.btnColor">å±•é–‹</button>
                </div>
            </div>

            <div class="flex justify-center gap-4 mt-2 bg-gray-50/50 p-2 rounded-2xl border border-gray-100">
                <button @click="setTheme('chiikawa')" class="avatar-btn w-12 h-12 rounded-full bg-pink-100 flex items-center justify-center text-2xl relative" 
                        :class="{'active ring-2 ring-pink-300': currentThemeKey === 'chiikawa'}">ğŸ¹</button>
                <button @click="setTheme('hachiware')" class="avatar-btn w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-2xl relative"
                        :class="{'active ring-2 ring-blue-300': currentThemeKey === 'hachiware'}">ğŸ±</button>
                <button @click="setTheme('usagi')" class="avatar-btn w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center text-2xl relative"
                        :class="{'active ring-2 ring-yellow-300': currentThemeKey === 'usagi'}">ğŸ°</button>
            </div>
        </div>
    </header>

    <div class="mx-4 mt-4 p-4 bg-white rounded-[2rem] shadow-lg border-2 transition-colors duration-300" :class="theme.lightBorder">
        <div class="flex justify-between items-center mb-2">
            <div class="flex flex-col">
                <div class="flex items-center gap-2">
                    <span class="text-xs font-bold text-white px-3 py-1 rounded-full shadow-sm transition-colors duration-300" :class="theme.btnColor">
                        JP Â¥ {{ currentRate }}
                    </span>
                    <span v-if="loading" class="text-xs animate-pulse" :class="theme.textColor">æ›´æ–°ä¸­...</span>
                </div>
                <div class="text-[10px] text-gray-400 mt-1 ml-1 font-medium">
                    <span v-if="lastUpdate">{{ lastUpdate }}</span>
                    <span v-else>é»æ“Šæ›´æ–° âœ</span>
                </div>
            </div>
            <button @click="fetchRate" class="text-gray-400 hover:opacity-70 text-sm p-2 rounded-full active:bg-gray-100 transition">ğŸ”„</button>
        </div>
        <div class="flex items-center gap-2 relative">
            <input type="number" v-model="jpyAmount" placeholder="è¼¸å…¥æ—¥å¹£..." 
                   class="w-full p-3 pl-4 bg-gray-50 border-2 border-dashed rounded-2xl text-lg font-bold text-gray-600 focus:outline-none transition-colors duration-300"
                   :class="theme.focusBorder" inputmode="numeric">
            <div class="absolute right-3 top-1/2 -translate-y-1/2 font-black text-xl pointer-events-none transition-colors duration-300" :class="theme.textColor">
                <span class="text-gray-300 text-sm mr-1">â‰ˆ</span>${{ twdAmount }}
            </div>
        </div>
    </div>

    <div class="p-4 space-y-6">
        <div class="card rounded-[2rem] overflow-hidden border transition-colors duration-300" :class="theme.lightBorder">
            <div @click="showHotel = !showHotel" class="p-4 flex justify-between items-center cursor-pointer transition-colors duration-300" :class="theme.lightBg">
                <h2 class="font-bold text-gray-700 flex items-center gap-2"><span>ğŸ¨</span> ä½å®¿èˆ‡é›†åˆ</h2>
                <span class="text-xl font-bold transition-transform duration-300" :class="[showHotel ? 'rotate-180' : '', theme.textColor]">âŒ„</span>
            </div>
            <div v-show="showHotel" class="p-4 space-y-3 text-sm bg-white">
                <div class="flex gap-3 items-start">
                    <div class="font-bold px-2 py-1 rounded-lg text-xs whitespace-nowrap bg-gray-100 text-gray-600">äº¬éƒ½</div>
                    <div>
                        <div class="font-bold text-gray-800">VIA INN PRIME å…«æ¢å£</div>
                        <div class="text-xs text-gray-400 mt-1">12/20-24 (4æ™š)</div>
                        <a :href="getMapLink('VIA INN PRIME KYOTOEKI HACHIJOGUCHI')" class="text-xs underline mt-1 inline-block" :class="theme.textColor">å°èˆª</a>
                    </div>
                </div>
                <div class="w-full h-px bg-gray-100"></div>
                <div class="flex gap-3 items-start">
                    <div class="font-bold px-2 py-1 rounded-lg text-xs whitespace-nowrap bg-gray-100 text-gray-600">å¤§é˜ª</div>
                    <div>
                        <div class="font-bold text-gray-800">ç›¸éµ Fresa Inn é›£æ³¢</div>
                        <div class="text-xs text-gray-400 mt-1">12/24-27 (3æ™š)</div>
                        <a :href="getMapLink('Sotetsu Fresa Inn Osaka-Namba')" class="text-xs underline mt-1 inline-block" :class="theme.textColor">å°èˆª</a>
                    </div>
                </div>
            </div>
        </div>

        <div v-for="(day, index) in itinerary" :key="index" class="relative group">
            <div @click="day.isOpen = !day.isOpen" 
                 class="sticky top-[180px] z-30 cursor-pointer mb-4 transition-transform active:scale-95">
                <div class="mx-auto w-full bg-white/95 backdrop-blur shadow-md rounded-full px-4 py-3 border-2 flex items-center justify-between transition-colors duration-300"
                     :class="day.isOpen ? theme.borderColor + ' ' + theme.textColor : 'border-gray-200 text-gray-500'">
                    <div class="flex items-center gap-3">
                        <span class="font-black rounded-full w-8 h-8 flex items-center justify-center text-sm shadow-inner transition-colors duration-300"
                              :class="day.isOpen ? theme.btnColor + ' text-white' : 'bg-gray-100 text-gray-600'">
                            {{ index + 1 }}
                        </span>
                        <span class="font-bold text-base">{{ day.date }}</span>
                        <span class="text-xs px-2 py-0.5 rounded-md bg-gray-50 border">{{ day.area }}</span>
                    </div>
                    <span class="text-xl font-bold" :class="day.isOpen ? theme.textColor : 'text-gray-300'">
                        {{ day.isOpen ? 'âˆ’' : '+' }}
                    </span>
                </div>
            </div>

            <div v-show="day.isOpen" class="space-y-4 px-1 pb-6">
                <div class="map-container shadow-inner">
                    <iframe 
                        :src="`https://googleusercontent.com/maps.google.com/29{encodeURIComponent(day.mapFocus || day.area)}&t=&z=14&ie=UTF8&iwloc=&output=embed`" 
                        frameborder="0" scrolling="no" marginheight="0" marginwidth="0">
                    </iframe>
                    <a :href="getDailyRouteLink(day.spots)" target="_blank" 
                       class="absolute inset-0 bg-black/10 hover:bg-black/20 flex items-center justify-center group/map transition">
                        <span class="bg-white/90 text-gray-800 px-4 py-2 rounded-full font-bold shadow-lg transform group-hover/map:scale-110 transition flex items-center gap-2 border-2 border-white">
                            <span>ğŸŒ±</span> é»æ“Šæª¢æŸ¥æ­¥è¡Œè·¯ç·š & æ­¥æ•¸
                        </span>
                    </a>
                </div>

                <div v-for="(item, i) in day.spots" :key="i" 
                     class="card rounded-[1.5rem] p-4 relative border-l-[6px]" 
                     :class="item.mustGo ? theme.borderColor : 'border-l-gray-300'"
                     @click.stop="openMap(item.name)">
                    
                    <div class="flex gap-4">
                        <div class="flex flex-col items-center gap-1 min-w-[50px]">
                            <span class="text-xs font-bold text-gray-400 bg-gray-100 px-2 py-1 rounded-lg">{{ item.time }}</span>
                            <div class="text-3xl mt-2 filter drop-shadow-sm">{{ getTypeIcon(item.type) }}</div>
                        </div>

                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-gray-700 text-lg leading-tight">{{ item.name }}</h3>
                                <span v-if="item.mustGo" class="shrink-0 text-[10px] text-white px-2 py-1 rounded-full shadow-sm ml-2 animate-pulse"
                                      :class="theme.btnColor">
                                    å¿…å»!
                                </span>
                            </div>
                            <div class="flex flex-wrap gap-1.5 mt-2">
                                <span class="text-[10px] px-2 py-1 rounded-lg font-bold bg-gray-100 text-gray-500">#{{ getTypeName(item.type) }}</span>
                            </div>
                            <p class="text-sm text-gray-500 mt-2 leading-relaxed font-medium">{{ item.desc }}</p>

                            <div v-if="item.ticket" class="mt-3">
                                <a :href="item.ticket.url" target="_blank" @click.stop 
                                   class="ticket-btn flex items-center gap-2 px-3 py-2 rounded-xl text-xs font-bold w-full justify-center border-2"
                                   :class="item.ticket.booked ? 'bg-green-50 text-green-700 border-green-200' : 'bg-red-50 text-red-500 border-red-200'">
                                    <span v-if="item.ticket.booked">âœ… å·²é è¨‚ ({{ item.ticket.source }})</span>
                                    <span v-else>ğŸ« å‰å¾€è³¼è²· ({{ item.ticket.source }})</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <transition name="fade">
        <button v-show="showScrollTop" @click="scrollToTop" 
                class="fixed bottom-6 right-6 w-14 h-14 rounded-full shadow-2xl z-50 flex items-center justify-center text-white text-2xl border-4 border-white transform transition-all duration-300 hover:scale-110 active:scale-95"
                :class="theme.btnColor">
            â–²
        </button>
    </transition>

</div>

<script>
    const { createApp, ref, computed, onMounted, onUnmounted } = Vue;

    const AID = '27749';
    const appendAID = (url) => {
        if (!url) return '#';
        if (url.includes('aid=')) return url;
        const separator = url.includes('?') ? '&' : '?';
        return `${url}${separator}aid=${AID}`;
    };

    const THEMES = {
        chiikawa: { name: 'å‰ä¼Š', icon: 'ğŸ¹', slogan: 'WakuWaku', bgGradient: 'bg-gradient-to-br from-pink-50 via-white to-pink-100', textColor: 'text-pink-500', borderColor: 'border-pink-300', btnColor: 'bg-pink-400', lightBg: 'bg-pink-50', lightBorder: 'border-pink-100', focusBorder: 'focus:border-pink-300' },
        hachiware: { name: 'å°å…«', icon: 'ğŸ±', slogan: 'Nantoka-nare', bgGradient: 'bg-gradient-to-br from-blue-50 via-white to-blue-100', textColor: 'text-blue-500', borderColor: 'border-blue-300', btnColor: 'bg-blue-400', lightBg: 'bg-blue-50', lightBorder: 'border-blue-100', focusBorder: 'focus:border-blue-300' },
        usagi: { name: 'çƒè–©å¥‡', icon: 'ğŸ°', slogan: 'Ura!', bgGradient: 'bg-gradient-to-br from-yellow-50 via-white to-orange-100', textColor: 'text-yellow-600', borderColor: 'border-yellow-400', btnColor: 'bg-yellow-400', lightBg: 'bg-yellow-50', lightBorder: 'border-yellow-200', focusBorder: 'focus:border-yellow-400' }
    };

    createApp({
        setup() {
            const currentThemeKey = ref('hachiware');
            const jpyAmount = ref('');
            const rate = ref(0.22);
            const currentRate = ref('0.2200');
            const loading = ref(false);
            const showHotel = ref(true);
            const lastUpdate = ref('');
            const showScrollTop = ref(false); // GoTop ç‹€æ…‹

            const theme = computed(() => THEMES[currentThemeKey.value]);
            const setTheme = (key) => currentThemeKey.value = key;

            const LINKS = {
                HARUKA: appendAID('https://www.klook.com/zh-TW/activity/18400-jr-haruka-airport-express-train-tickets-osaka/'),
                AMANOHASHIDATE: appendAID('https://www.klook.com/zh-TW/activity/25686-amanohashidate-ine-boathouse-miyama-kayabuki-no-sato-day-tour-osaka/'),
                UMEDA_SKY: appendAID('https://www.klook.com/zh-TW/activity/1301-umeda-sky-building-osaka/'),
                RAPIT: appendAID('https://www.klook.com/zh-TW/activity/599-kansai-airport-nankai-line-osaka/'),
                HARUKAS: appendAID('https://www.klook.com/zh-TW/activity/2424-harukas-300-observatory-ticket-osaka/')
            };

            const fetchRate = async () => {
                loading.value = true;
                try {
                    const res = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://tw.rter.info/capi.php'));
                    const raw = await res.json();
                    const data = JSON.parse(raw.contents);
                    if(data.USDTWD && data.USDJPY) {
                        const usdToTwd = data.USDTWD.Exrate;
                        const usdToJpy = data.USDJPY.Exrate;
                        const calculatedRate = usdToTwd / usdToJpy;
                        rate.value = calculatedRate;
                        currentRate.value = calculatedRate.toFixed(4);
                        lastUpdate.value = `æ›´æ–°æ™‚é–“: ${data.USDTWD.UTC}`;
                    }
                } catch(e) { console.error(e); } finally { loading.value = false; }
            };

            // Go Top é‚è¼¯
            const handleScroll = () => {
                showScrollTop.value = window.scrollY > 300;
            };
            const scrollToTop = () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // è¡Œç¨‹è³‡æ–™ (ä¿æŒä¸è®Š)
            const itinerary = ref([
                {
                    date: '12/20 (å…­)', area: 'äº¬éƒ½è»Šç«™', mapFocus: 'Kyoto Station', isOpen: true,
                    spots: [
                        { time: '12:50', type: 'spot', name: 'é—œè¥¿æ©Ÿå ´', desc: 'å…¥å¢ƒ / é ˜å– Haruka è»Šç¥¨', ticket: { source: 'Klook', url: LINKS.HARUKA, booked: true }},
                        { time: '15:00', type: 'spot', name: 'VIA INN PRIME äº¬éƒ½ç«™å…«æ¢å£', desc: 'Check-in (è»Šç«™å…«æ¢å£)' },
                        { time: '17:00', type: 'food', mustGo: true, name: 'Sushi no Musashi', desc: 'è¿´è½‰å£½å¸ (é£¯åº—æ—)' },
                        { time: '19:00', type: 'shop', name: 'Kyoto Station Building', desc: 'å¤§éšæ¢¯ / è–èª•æ¨¹' }
                    ]
                },
                {
                    date: '12/21 (æ—¥)', area: 'åµå±±/é‡‘é–£å¯º', mapFocus: 'Arashiyama Bamboo Forest', isOpen: true,
                    spots: [
                        { time: '09:00', type: 'spot', mustGo: true, name: 'åµå±±ç«¹æ—ä¹‹é“ (Arashiyama Bamboo Grove)', desc: 'å¿…æ‹ç¶“å…¸ï¼å»ºè­°æ—©èµ·é¿é–‹äººæ½®' },
                        { time: '10:30', type: 'spot', name: 'å¤©é¾å¯º (Tenryu-ji)', desc: 'ä¸–ç•Œéºç”¢åº­åœ’' },
                        { time: '12:00', type: 'food', name: 'åµå±±å¤§è¡—åˆé¤', desc: 'æ¨è–¦ï¼šå»£å·é°»é­šé£¯ æˆ– é¯›åŒ HANANA' },
                        { time: '13:30', type: 'spot', mustGo: true, name: 'é‡‘é–£å¯º (Kinkaku-ji)', desc: 'æ­ä¹˜è¨ˆç¨‹è»Šå‰å¾€ï¼Œä¸‹åˆé™½å…‰æœ€ç¾' },
                        { time: '16:00', type: 'spot', name: 'äº¬éƒ½è»Šç«™', desc: 'è¿”å›ä¼‘æ¯' }
                    ]
                },
                {
                    date: '12/22 (ä¸€)', area: 'æµ·ä¹‹äº¬éƒ½ä¸€æ—¥éŠ', mapFocus: 'Amanohashidate', isOpen: true,
                    spots: [
                        { time: '07:40', type: 'spot', mustGo: true, name: 'äº¬éƒ½é§…å…«æ¢å£', desc: 'ä¸€æ—¥éŠé›†åˆ (AVANTIå‰)', ticket: { source: 'Klook', url: LINKS.AMANOHASHIDATE, booked: false }},
                        { time: '10:30', type: 'spot', name: 'å¤©æ©‹ç«‹ View Land', desc: 'é£›é¾åœ¨å¤©' },
                        { time: '13:00', type: 'spot', name: 'ä¼Šæ ¹èˆŸå±‹', desc: 'é¤µé£Ÿæµ·é·—' },
                        { time: '19:00', type: 'food', name: 'äº¬éƒ½æ‹‰éºµå°è·¯', desc: 'æ™šé¤ (è»Šç«™10æ¨“)' }
                    ]
                },
                {
                    date: '12/23 (äºŒ)', area: 'æ´›æ±ç²¾è¯', mapFocus: 'Nishiki Market', isOpen: true,
                    spots: [
                        { time: '09:00', type: 'spot', name: 'ä¼è¦‹ç¨»è·å¤§ç¤¾', desc: 'åƒæœ¬é³¥å±…' },
                        { time: '10:00', type: 'shop', mustGo: true, name: 'Chiikawa Mogumogu Honpo', desc: 'å‰ä¼Šå¡å“‡ä¼è¦‹åº—' },
                        { time: '11:00', type: 'food', mustGo: true, name: 'Kyoto Ito Okashi', desc: 'ä¼Šè—¤è»’ç”œé»' },
                        { time: '12:00', type: 'food', mustGo: true, name: 'éŒ¦å¸‚å ´ (Nishiki Market)', desc: 'å‰å¾€æ²³åŸç”ºï¼Œåƒè±†ä¹³ç”œç”œåœˆ/ç‰å­ç‡’' },
                        { time: '14:00', type: 'spot', mustGo: true, name: 'æ¸…æ°´å¯º', desc: 'æ­å…¬è»Šæˆ–è¨ˆç¨‹è»Šå‰å¾€' },
                        { time: '15:30', type: 'shop', mustGo: true, name: '2/8b pair keyholder äº¬éƒ½æ¸…æ°´åº—', desc: 'å¯æ„›åŠé£¾åº—' },
                        { time: '16:30', type: 'cafe', mustGo: true, name: 'Blue Bottle Coffee Woodbury', desc: 'è—ç“¶æœ¨å±‹ç”ºåº—' }
                    ]
                },
                {
                    date: '12/24 (ä¸‰)', area: 'ç§»å‹•/å¿ƒé½‹æ©‹', mapFocus: 'Shinsaibashi PARCO', isOpen: true,
                    spots: [
                        { time: '10:00', type: 'spot', name: 'å¤§é˜ª Check-in', desc: 'Sotetsu Fresa Inn é›£æ³¢' },
                        { time: '12:30', type: 'food', mustGo: true, name: 'ä¸€è˜­ é›£æ³¢å¾¡å ‚ç­‹åº—', desc: 'åˆé¤' },
                        { time: '14:00', type: 'shop', mustGo: true, name: 'Chiikawa Land Shinsaibashi', desc: 'PARCO å‰ä¼Šå¡å“‡' },
                        { time: '19:00', type: 'food', mustGo: true, name: 'Shabucho', desc: 'å’Œç‰›æ¶®æ¶®é‹' }
                    ]
                },
                {
                    date: '12/25 (å››)', area: 'æ¢…ç”°/è–èª•', mapFocus: 'Umeda Station', isOpen: true,
                    spots: [
                        { time: '10:00', type: 'shop', mustGo: true, name: 'Standard Products Umeda DT Tower', desc: 'æ¢…ç”°DTå¡”B2' },
                        { time: '10:30', type: 'shop', mustGo: true, name: 'DAISO Umeda DT Tower', desc: 'ç™¾å…ƒåº—' },
                        { time: '11:30', type: 'shop', mustGo: true, name: '3COINS +plus LUCUA', desc: 'LUCUAç™¾è²¨' },
                        { time: '12:30', type: 'food', mustGo: true, name: 'ç‰›å¤ªæœ¬é™£ LINKS UMEDA', desc: 'åˆé¤ï¼šç‡’è‚‰' },
                        { time: '14:30', type: 'shop', mustGo: true, name: 'Kiddyland å¤§é˜ªæ¢…ç”°åº—', desc: 'å‰ä¼Šå¡å“‡å‘¨é‚Š' },
                        { time: '17:00', type: 'food', mustGo: true, name: 'Sukiyaki Iroha Kitamise', desc: 'æ™šé¤ï¼široha å£½å–œç‡’ (åŒ—æ–°åœ°)' },
                        { time: '19:00', type: 'spot', name: 'æ¢…ç”°è—å¤©å¤§å»ˆ', desc: 'è–èª•å¸‚é›†å¤œæ™¯', ticket: { source: 'Klook', url: LINKS.UMEDA_SKY, booked: false }},
                        { time: '21:00', type: 'food', mustGo: true, name: 'éº¥Ã—é·„ (Mugi to Tori)', desc: 'å®µå¤œï¼šé›ç™½æ¹¯æ‹‰éºµ' }
                    ]
                },
                {
                    date: '12/26 (äº”)', area: 'é›£æ³¢/é˜¿å€é‡', mapFocus: 'Harukas 300', isOpen: true,
                    spots: [
                        { time: '10:00', type: 'food', mustGo: true, name: 'CANELÃ‰ du JAPON', desc: 'å¯éº—éœ²' },
                        { time: '12:30', type: 'food', mustGo: true, name: 'ã†ãªãã®ä¸­åº„ é›£æ³¢åº—', desc: 'é°»é­šé£¯' },
                        { time: '14:30', type: 'shop', name: 'é›£æ³¢ Parks', desc: 'é€›è¡—è£œè²¨' },
                        { time: '16:30', type: 'spot', mustGo: true, name: 'Harukas 300 (Abeno Harukas)', desc: 'é˜¿å€é‡å±•æœ›å°', ticket: { source: 'Klook', url: LINKS.HARUKAS, booked: false }},
                        { time: '19:00', type: 'food', mustGo: true, name: 'ç‡’è‚‰åŠ›ä¸¸ é›£æ³¢é“é “å €åº—', desc: 'ç‡’è‚‰åƒåˆ°é£½' }
                    ]
                },
                {
                    date: '12/27 (å…­)', area: 'è¿”ç¨‹', mapFocus: 'Kansai Airport', isOpen: true,
                    spots: [
                        { time: '09:30', type: 'spot', name: 'å—æµ·é›£æ³¢ç«™', desc: 'æ­ä¹˜ Rapi:t', ticket: { source: 'Klook', url: LINKS.RAPIT, booked: false }},
                        { time: '10:30', type: 'shop', name: 'Rinku Premium Outlets', desc: 'è‡¨ç©ºåŸ Outlet' },
                        { time: '14:00', type: 'spot', name: 'Kansai Airport', desc: 'JX823 èµ·é£›' }
                    ]
                }
            ]);

            const expandAll = (state) => { itinerary.value.forEach(day => day.isOpen = state); };
            const twdAmount = computed(() => !jpyAmount.value ? 0 : Math.ceil(jpyAmount.value * rate.value));
            const getMapLink = (q) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`;
            const openMap = (q) => window.open(getMapLink(q), '_blank');
            const getDailyRouteLink = (spots) => {
                if (spots.length < 2) return '#';
                const validSpots = spots.map(s => s.name);
                const origin = encodeURIComponent(validSpots[0]);
                const destination = encodeURIComponent(validSpots[validSpots.length - 1]);
                const waypoints = validSpots.slice(1, -1).map(s => encodeURIComponent(s)).join('|');
                return `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}&waypoints=${waypoints}&travelmode=transit`;
            };
            const getTypeIcon = (t) => ({food:'ğŸœ',shop:'ğŸ›ï¸',spot:'â›©ï¸',cafe:'â˜•'}[t] || 'ğŸ“');
            const getTypeName = (t) => ({food:'ç¾é£Ÿ',shop:'è³¼ç‰©',spot:'æ™¯é»',cafe:'å’–å•¡'}[t] || 'è¡Œç¨‹');

            onMounted(() => {
                fetchRate();
                window.addEventListener('scroll', handleScroll);
            });

            onUnmounted(() => {
                window.removeEventListener('scroll', handleScroll);
            });

            return { 
                jpyAmount, twdAmount, currentRate, loading, fetchRate, itinerary, 
                getMapLink, openMap, showHotel, expandAll, getDailyRouteLink, 
                getTypeIcon, getTypeName, currentThemeKey, theme, setTheme, lastUpdate,
                showScrollTop, scrollToTop
            };
        }
    }).mount('#app');
</script>

</body>
</html>